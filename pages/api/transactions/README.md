# Документация API “Транзакции”

Все роуты ниже доступны **только** для авторизованных пользователей.

При попытке доступа без Bearer токена, апи будет отдавать ошибку 401.

## Получить список транзакций

адрес: https://wedev-api.sky.pro/api/transactions

метод: GET

Возвращает все транзакции пользователя в виде массива, например:

```json
[
  {
    "_id": "67e4688c8d573f845a6083f3",
    "userId": "67e2cba0d743f2b960865bcb",
    "description": "asdasd",
    "category": "joy",
    "date": "2025-12-11T21:00:00.000Z",
    "sum": 1
  },
  {
    "_id": "67e46c608d573f845a6083f4",
    "userId": "67e2cba0d743f2b960865bcb",
    "description": "aasasd",
    "category": "joy",
    "date": "2025-12-11T21:00:00.000Z",
    "sum": 1
  }
]
```

## Получить список транзакций (сортировка и фильтрация)

адрес: https://wedev-api.sky.pro/api/transactions

метод: GET

Для сортировки и фильтрации можно добавить к ссылке еще параметры.

| Параметр | Тип    | Значения                |
| -------- | ------ | ----------------------- |
| sortBy   | string | `date` или `sum`        |
| filterBy | string | Категории через запятую |

#### Валидные значения категории:

`food`, `transport`, `housing`, `joy`, `education`, `others`

При добавлении параметра фильтрации, будут выведены только транзакции имеющие переданную категорию (например, указали food, transport из API придут только транзакции с категориями "Еда", "Транспорт").

При добавлении параметра сортировки, транзакции выведутся в порядке убывания по выбранному полю (например, если мы выбрали поле sum, то из API придут транзакции по убыванию суммы).

Пример запроса на фильтрацию по категориям "Еда" и "Транспорт", сортировке по убыванию по дате:

https://wedev-api.sky.pro/api/transactions?sortBy=date&filterBy=food,transport

Пример запроса на фильтрацию по категории "Образование" без сортировки

https://wedev-api.sky.pro/api/transactions?filterBy=education

При верном вводе апи вернет 200 статус и соответствующий критериям список транзакций.

Если критерии введены неверно, то вернет статус 400, сообщение об ошибке ввода параметров.

## Добавить транзацию

адрес: https://wedev-api.sky.pro/api/transactions

метод: POST

В тело запроса необходимо передать значения по следующим правилам:

```json
{
  "description": "должна быть строкой, минимум 4 символа",
  "sum": "положительное число",
  "category": "Валидная категория",
  "date": "Должна быть датой"
}
```

#### Валидные значения категории:

`food`, `transport`, `housing`, `joy`, `education`, `others`

Пример валидного тела запроса:

```json
{
  "description": "Новая транзакция",
  "sum": 3500,
  "category": "joy",
  "date": "6-1-2025"
}
```

**Важно!** В поле дата можно увидеть запись 6-1-2025, где 6 - месяц, 1 - день, 2025 - год.

При успешном добавлении api вернет 201 статус и обновленный список всех транзакций.

При неверном вводе, api вернет 400 статус и ошибку в ответе.

## Удалить транзацию

адрес: https://wedev-api.sky.pro/api/transactions/:id

метод: DELETE

:id - id транзкции.

В тело запроса ничего не требуется.

Пример запроса:

http://wedev-api.sky.pro/api/transactions/67e45adf8d573f845a6083ed

При успешном удалении возвращает статус код 201, и обновленный список всех транзакций.

Возвращает статус код 400, если транзация уже удалена.

## Обновить транзацию

адрес: https://wedev-api.sky.pro/api/transactions/:id

метод: PATCH

:id - id транзкции.

В тело запроса нужно передать новый данные для транзакции.

```json
{
  "description": "new Description",
  "sum": 3500,
  "category": "food",
  "date": "12-12-2025"
}
```

Пример запроса:

http://wedev-api.sky.pro/api/transactions/67e45adf8d573f845a6083ed

При успешном обновлении возвращает статус код 201, и обновленный список всех транзакций.

Возвращает статус код 400, если транзация не найдена или данные не прошли валидацию (см. правила валидации выше в пункте "Добавление транзакции").

## Получить транзакции за определенный период

адрес http://wedev-api.sky.pro/api/transactions/period

метод: POST

В тело запроса нужно передать json с началом и концом периода, за который мы хотим получить транзакции. Пример:

```json
{
  "start": "12-1-2024",
  "end": "12-1-2025"
}
```

При таком запросе мы получим транзакции пользователя с декабря 2024 до декабря 2025 года.

Пример ответа:

```json
[{
    {
		"_id": "67e4688c8d573f845a6083f3",
		"userId": "67e2cba0d743f2b960865bcb",
		"description": "test1",
		"category": "joy",
		"date": "2025-12-11T21:00:00.000Z",
		"sum": 1
	},
	{
		"_id": "67e46c608d573f845a6083f4",
		"userId": "67e2cba0d743f2b960865bcb",
		"description": "test3",
		"category": "food",
		"date": "2025-12-11T21:00:00.000Z",
		"sum": 122
	},
	{
		"_id": "67e47d408d573f845a6083f5",
		"userId": "67e2cba0d743f2b960865bcb",
		"description": "test2",
		"category": "joy",
		"date": "2025-12-10T21:00:00.000Z",
		"sum": 11111
	},
}]
```
