# Документация API “Instapro” v1

**Base URL:** https://webdev-hw-api.vercel.app/api/v1/:personal-key/instapro

К base URL нужно «приклеить» адрес конкретного API endpoint’а из списка ниже.

"боевая" версия Instapro, доступна по адресу:
https://webdev-hw-api.vercel.app/api/v1/prod/instapro

В разработке используйте свой уникальный `:personal-key`, чтобы получить не зависимый от других API. По умолчанию персональный API пустой.

## Api endpoints

### Получить посты всех пользователей

Возвращает общую ленту постов от всех пользователей приложения

адрес: /

метод: GET

Возвращает код 200 и список постов.

```json
{
  "posts": [
    {
      "id": "642bf333b959b2a4679f2e69",
      "imageUrl": "https://storage.yandexcloud.net/skypro-webdev-homework-bucket/1680601903167-%25C3%2590%25C2%25A1%25C3%2590%25C2%25BD%25C3%2590%25C2%25B8%25C3%2590%25C2%25BC%25C3%2590%25C2%25BE%25C3%2590%25C2%25BA%2520%25C3%2591%25C2%258D%25C3%2590%25C2%25BA%25C3%2591%25C2%2580%25C3%2590%25C2%25B0%25C3%2590%25C2%25BD%25C3%2590%25C2%25B0%25202023-03-31%2520%25C3%2590%25C2%25B2%252012.45.42.png",
      "createdAt": "2023-04-04T09:51:47.187Z",
      "description": "Это я",
      "user": {
        "id": "642bf323b959b2a4679f2e68",
        "name": "Глеб Фокин",
        "login": "glebkaf777",
        "imageUrl": "https://storage.yandexcloud.net/skypro-webdev-homework-bucket/1680601877737-%25C3%2590%25C2%25A1%25C3%2590%25C2%25BD%25C3%2590%25C2%25B8%25C3%2590%25C2%25BC%25C3%2590%25C2%25BE%25C3%2590%25C2%25BA%2520%25C3%2591%25C2%258D%25C3%2590%25C2%25BA%25C3%2591%25C2%2580%25C3%2590%25C2%25B0%25C3%2590%25C2%25BD%25C3%2590%25C2%25B0%25202023-03-31%2520%25C3%2590%25C2%25B2%252012.58.33.png"
      },
      "likes": [
        { "id": "642bf323b959b2a4679f2e68", "name": "Глеб Фокин" },
        { "id": "64226edb0cdb1574f162d950", "name": "Глеб Админ" },
        { "id": "64255dabca1ce2a815a327d7", "name": "Глеб" }
      ],
      "isLiked": false
    },
    {
      "id": "642bf2f4b959b2a4679f2e67",
      "imageUrl": "https://storage.yandexcloud.net/skypro-webdev-homework-bucket/1680601839236-%25C3%2590%25C2%25A1%25C3%2590%25C2%25BD%25C3%2590%25C2%25B8%25C3%2590%25C2%25BC%25C3%2590%25C2%25BE%25C3%2590%25C2%25BA%2520%25C3%2591%25C2%258D%25C3%2590%25C2%25BA%25C3%2591%25C2%2580%25C3%2590%25C2%25B0%25C3%2590%25C2%25BD%25C3%2590%25C2%25B0%25202023-03-31%2520%25C3%2590%25C2%25B2%252012.51.20.png",
      "createdAt": "2023-04-04T09:50:44.832Z",
      "description": "Вторая фотка",
      "user": {
        "id": "64226edb0cdb1574f162d950",
        "name": "Глеб Админ",
        "login": "admin",
        "imageUrl": "https://storage.yandexcloud.net/skypro-webdev-homework-bucket/1680601502867-%25C3%2590%25C2%25A1%25C3%2590%25C2%25BD%25C3%2590%25C2%25B8%25C3%2590%25C2%25BC%25C3%2590%25C2%25BE%25C3%2590%25C2%25BA%2520%25C3%2591%25C2%258D%25C3%2590%25C2%25BA%25C3%2591%25C2%2580%25C3%2590%25C2%25B0%25C3%2590%25C2%25BD%25C3%2590%25C2%25B0%25202023-04-04%2520%25C3%2590%25C2%25B2%252014.04.29.png"
      },
      "likes": [
        { "id": "642bf323b959b2a4679f2e68", "name": "Глеб Фокин" },
        { "id": "64226edb0cdb1574f162d950", "name": "Глеб Админ" }
      ],
      "isLiked": false
    }
  ]
}
```

В запросах без авторизации флаг isLiked всегда false. Если сделать запрос с авторизацией, то флаг покажет, лайкал ли текущий пользователь этот пост.

### Получить посты конкретного пользователя

Возвращает ленту постов конкретного пользователя.

адрес: /user-posts/:id

Вместо :id нужно передать id пользователя, посты которого нужно получить, например: /user-posts/64253cdbca1ce2a815a327d3

метод: GET

Возвращает данные в том же формате и по тем же правилам, что и API выше.

### Добавить новый пост

API работает только с авторизацией, подробнее читайте в разделе "Авторизация". 

адрес: /

метод: POST

В теле запроса принимает объект пост в формате JSON, описание фотографии и ссылку на фотографию:

```json
{
  "description": "Этот котик очень красивый",
  "imageUrl": "https://storage.yandexcloud.net/skypro-webdev-homework-bucket/1680601502867-%25C3%2590%25C2%25A1%25C3%2590%25C2%25BD%25C3%2590%25C2%25B8%25C3%2590%25C2%25BC%25C3%2590%25C2%25BE%25C3%2590%25C2%25BA%2520%25C3%2591%25C2%258D%25C3%2590%25C2%25BA%25C3%2591%25C2%2580%25C3%2590%25C2%25B0%25C3%2590%25C2%25BD%25C3%2590%25C2%25B0%25202023-04-04%2520%25C3%2590%25C2%25B2%252014.04.29.png"
}
```

Загрузить фото в облако и получить на него ссылку можно в [API загрузки фотографий](../../../upload/README.md).

API возвращает код 201 и объект результата:

```json
{ "result": "ok" }
```

Возвращает код 400 и объект с ошибкой в формате JSON в следующих случаях:

- В теле запроса не передан description. 
- В теле запроса не передан imageUrl. 
- В description - пустая строчка. 

### Поставить лайк

API работает только с авторизацией, подробнее читайте в разделе "Авторизация". 

API ставит лайк на пост от имени авторизованного юзера, если его там не было.

адрес: /:id/like

Вместо :id нужно передать id поста, который возвращает API списка постов, например: /64253cdbca1ce2a815a327d3/like

метод: POST

Возвращает код 201 и объект результата:

```json
{ "result": "ok" }
```

### Убрать лайк

API работает только с авторизацией, подробнее читайте в разделе "Авторизация". 

API убирает лайк у поста от имени авторизованного юзера, если он там был.

адрес: /:id/dislike

Вместо :id нужно передать id поста, который возвращает API списка постов, например: /64253cdbca1ce2a815a327d3/dislike

метод: POST

Возвращает код 201 и объект результата:

```json
{ "result": "ok" }
```

## Авторизация

Некоторые эндпоинты API работают только с авторизацией.

В таких эндпоинтах используется авторизация по Bearer токену.
Передайте в заголовке Authorization пользовательский токен "Bearer ksdfsksdfjfsdjk".

Токен можно получить в [API авторизации](../../../user/README.md). 

Запросы без авторизации в такие эндпоинты возвращают 401 статус ответа. 
